<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Noticias Deportes Chile - VIVO24®</title>
  <!-- Bootstrap CSS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      background-color: #121212;
      color: #eee;
      padding: 20px;
      font-family: Arial, sans-serif;
    }
    h1 {
      color: #ffffff;
      text-align: center;
      margin-bottom: 30px;
      font-weight: 700;
    }
    #contenedorNoticias {
      max-width: 720px;
      margin: 0 auto;
    }
    .news-item {
      background: #222;
      padding: 15px 20px;
      border-radius: 10px;
      margin-bottom: 18px;
      box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
    }
    .news-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: #81c784;
      margin-bottom: 8px;
    }
    .news-date {
      font-size: 0.85rem;
      color: #999;
      margin-bottom: 12px;
    }
    .btn-vermas {
      text-decoration: none;
      background-color: #00daf7;
      color: white;
      padding: 6px 12px;
      border-radius: 5px;
      font-weight: 500;
      transition: background-color 0.3s ease;
    }
    .btn-vermas:hover {
      background-color: #01d2f7;
      color: white;
    }
    .ultima-noticia {
      border: 2px solid #06eeff;
      box-shadow: 0 0 15px #4caf50;
    }
    .badge {
      font-size: 0.75rem;
      padding: 5px 10px;
    }
  </style>
</head>
<body>

  <h1>Noticias Deportes Chile</h1>
  <div id="contenedorNoticias">
    <p class="text-center">Cargando noticias...</p>
  </div>

  <script>
    // Formatea la fecha en zona horaria Chile con fecha y hora legible
    function formatearTiempoYHoraChile(fechaString) {
      if (!fechaString) return '';
      try {
        const fecha = new Date(fechaString);
        return fecha.toLocaleString('es-CL', {
          dateStyle: 'medium',
          timeStyle: 'short',
          timeZone: 'America/Santiago'
        });
      } catch {
        return fechaString;
      }
    }


    // Función para cargar noticias (usa la API RSS2JSON o similar)
    async function cargarNoticias(apiUrl, contenedorId, limit = 10) {
      try {
        const res = await fetch(apiUrl);
        if (!res.ok) throw new Error('Error al cargar noticias');
        const data = await res.json();

        const contenedor = document.getElementById(contenedorId);
        if (!contenedor) return;
        contenedor.innerHTML = '';

        const items = data.articles || data.items || [];
        if (!items.length) {
          contenedor.innerHTML = '<p>No hay noticias disponibles.</p>';
          return;
        }

        // Ordenar por fecha descendente
        items.sort((a, b) => new Date(b.publishedAt || b.pubDate) - new Date(a.publishedAt || a.pubDate));
        const noticiasRecientes = items.slice(0, limit);

        // Alerta para la primera noticia
        if (noticiasRecientes.length > 0) {
          const noticia = noticiasRecientes[0];
          mostrarAlertaNoticia(noticia.title, noticia.url || noticia.link);
        }

        // Construcción de cada noticia
        noticiasRecientes.forEach((item, i) => {
          const titulo = item.title || 'Sin título';
          const link = item.url || item.link || '#';
          const infoTiempo = formatearTiempoYHoraChile(item.publishedAt || item.pubDate);

          const div = document.createElement('div');
          div.className = 'news-item';
          if (i === 0) div.classList.add('ultima-noticia');

          div.innerHTML = `
            <div class="news-title">${titulo}</div>
            <div class="news-date">${infoTiempo}</div>
            <a href="${link}" target="_blank" class="btn-vermas">Ver más</a>
            <div class="d-flex justify-content-end">
              <span class="badge rounded-pill text-bg-dark">VIVO24® | Noticias</span>
            </div>
          `;
          contenedor.appendChild(div);
        });

      } catch (e) {
        console.error('Error cargando noticias:', e);
        const contenedor = document.getElementById(contenedorId);
        if (contenedor) contenedor.innerHTML = '<p>Error al cargar noticias.</p>';
      }
    }

    // URL RSS2JSON para Google News deportes Chile
    // Puedes obtener un API key gratuita en https://rss2json.com/docs
    // Esta URL busca "deportes" en Google News para Chile
    const apiGoogleNewsDeportesChile = 'https://api.rss2json.com/v1/api.json?rss_url=' + 
      encodeURIComponent('https://news.google.com/rss/search?q=fútbol&hl=es-419&gl=CL&ceid=CL:es');

    // Carga noticias al iniciar la página
    cargarNoticias(apiGoogleNewsDeportesChile, 'contenedorNoticias', 10);
  </script>

</body>
</html>
